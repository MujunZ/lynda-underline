<!DOCTYPE html>
<html>
<head>
    <title>Iterating Collections with Underscore</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="../underscore-min.js"></script>
    <script type="text/javascript" src="../SampleData.js"></script>
    <script type="text/javascript">
    function getStudentInfo (elem,indx,list) {
    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
    	$('#container').append(student);
    }

    function searchStudentsBySchool (elem) {
    	if (elem.school === "Franklin") {
    		return true;
    	}
    }

    function getPassingStudents (elem) {
    	return ((elem.midterm_score + elem.final_score)/2 > 65);
    }

    function checkImprovement (elem) {
    	return elem.final_score > elem.midterm_score; 
    }

    function sortStudentsByGrade (elem) {
    	return elem.grade;
    }

    function groupStudentsBySchool (elem) {
    	return elem.school;
    }

    function countStudentsByGrade (elem) {
    	if (elem.grade === 9) {
    		return 'freshmen';
    	}else if (elem.grade === 10) {
    		return 'sophomores';
    	}else if (elem.grade === 11) {
    		return 'junior';
    	}else if (elem.grade === 12) {
    		return 'seniors';
    	}
    }

    function assignGrades (elem) {
        var grade = (elem.midterm_score + elem.final_score)/2;
        var letterGrade;

        if (grade <= 64) {
            letterGrade = 'F';
        }else if (grade > 64 && grade <= 69) {
            letterGrade = 'D';
        }else if (grade >=70 && grade <= 79) {
            letterGrade = 'C';
        }else if (grade >= 80 && grade <= 89) {
            letterGrade = 'B';
        }else if (grade >= 90) {
            letterGrade = 'A';
        }

        return '<p>' + elem.firstname + ' ' + elem.lastname + ': ' + letterGrade + '</p>';
    }

    function listGrade (grades) {
    	$('#grades').append(grades);
    }

    window.addEventListener("load", function(e) {
    	var numStudentElem = document.getElementById("numstudents");
    	/* _.size to get number of elements */
    	numStudentElem.innerHTML = numStudentElem.innerHTML + _.size(students);

    	/* _.each() to iterate over every element */
    	_.each(students, getStudentInfo);


    	/* -.find() the first student that goes to Franklin */
    	var isFromFranklin = _.find(students,searchStudentsBySchool);

    	var student = "<p>" + isFromFranklin.firstname + " " + isFromFranklin.lastname + ", Grade: " + isFromFranklin.grade + "</p>";
    	$('#isFromFranklin').append(student);

    	/* _.findWhere() return the first Toreau student who is a junior */
    	var isThoreau = _.findWhere(students, {school: "Thoreau", grade: 11});
    	var isThoreauStudent = "<p>" + isThoreau.firstname + " " + isThoreau.lastname + ", Grade: " + isThoreau.grade + "</p>";
    	$('#isThoreau').append(isThoreauStudent);

    	/* _.pluck() retrieves all the values for a given property name and _.contains searches a list of values for a value */
    	// pass all the final_score to grades
    	var grades = _.pluck(students, "final_score");
    	// find the perfect final
    	if(_.contains(grades,100))
    		console.log("Found a perfect final score!");

    	/* _.filter() to filt the elements in a certain way */
    	var passingStudents = _.filter(students, getPassingStudents);
    	/* use _.each() to write the content */
    	_.each(passingStudents, function (elem,indx,list) {
	    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
	    	$('#passingStudents').append(student);
    	})

    	/* _.where finds all the elements meet the standard */
    	var allThoreauGrade11 = _.where(students, {school: "Thoreau", grade: 10});
    	_.each(allThoreauGrade11, function (elem,indx,list) {
	    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
	    	$('#throeauGrade11').append(student);
    	})

    	/* _.reject() to fill out failed students 
    	* _.reject() is _.filter's complement
    	*/
    	var failedStudents = _.reject(students, getPassingStudents);
    	_.each(failedStudents,function (elem,indx,list) {
	    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
	    	$('#failedStudents').append(student);
    	})

    	/* _.every() to ensure that all of a set of criteria have been met */
    	console.log(_.every(students, checkImprovement));
    	/* _.some() to check if there's any element meets the criteria
    	* _.some() and _.contains are different, b/c _.contains ckeck a value in an array.
    	*/
    	console.log(_.some(students, checkImprovement));

    	/* _.sortBy() by grade 
    	*  if want to sort by the length of firstname, simply use elem.firstname.length in sortStudentsByGrade().
    	*/
    	var sortByGrade = _.sortBy(students, sortStudentsByGrade);
    	_.each(sortByGrade, function (elem,indx,list) {
	    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
	    	$('#sortByGrade').append(student);
    	})

    	/* grouping students by school */
    	var groupBySchool = _.groupBy(students, groupStudentsBySchool);

    	/* for-in loop can only be used in object/map/hash.*/
    	for(var sch in groupBySchool){
    		var school = '<p style="font-weight:bold">Students that go to ' + sch + '</p>';
    		$('#groupBySchool').append(school);
    		/* see the difference between sch and groupBySchool[sch] */
    		_.each(groupBySchool[sch], function (elem,indx,list) {
	    	var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
	    		$('#groupBySchool').append(student);
    		})
    	}

    	/* number of students in each grade */
    	var countByGrade = _.countBy(students, countStudentsByGrade);
    	for (var gr in countByGrade) {
    		var grade = '<p style="font-weight:bold">' + gr + ': '+ countByGrade[gr] +' students</p>';
    		$('#countByGrade').append(grade);
    	}

        /* _.shuffle randomizes the contents of the list using an algorithm called the Fisher-Yates shuffle */
        var shuffledStudents = _.shuffle(students);
        _.each(shuffledStudents, function (elem,indx,list) {
            var student = "<p>" + elem.firstname + " " + elem.lastname + ", Grade: " + elem.grade + "</p>";
            $('#shuffledStudents').append(student);
        })

        /* _.map creates a new array based upon each items in the list */
        var finalGrades = _.map(students, assignGrades);
        listGrade(finalGrades);

        /* Extracting Array Data */
        // pluck midterm scores
        var midTermScores = _.pluck(students,"midterm_score");
        midTermScores.sort();

        // _.first() and _.last()
        var firstAndLast = "<h1>First and Last</h1><p id = 'firstAndLast'>First score is " + _.first(midTermScores) + ".</p><p>Last score is " + _.last(midTermScores) + ".</p>";
        $('body').append(firstAndLast);

        // _.initial() and _.rest() is very similar to _.first() and _.rest()
        var initialAndRest = "<h1>Initial and Rest</h1><p id = 'initialAndRest'>Initial scores, minus the last 3 : " + _.initial(midTermScores,3) + ".</p><p> From the 4th score : " + _.rest(midTermScores,3) + ".</p>";
        $('body').append(initialAndRest);
    });
    </script>
</head>
<body>
	<h1>Iterating Collections with Underscore</h1>
	<h2>Student Information:</h2>
	<h3 id="numstudents">Number of Students: </h3>
	<div id="container">
	</div>
	<h1>The following students are from Franklin</h1>
	<div id="isFromFranklin">
	</div>
	<h1>The First Thoreau Student Who Is A Junior</h1>
	<div id="isThoreau"></div>
	<h1>Students who passed</h1>
	<div id="passingStudents"></div>
	<h1>Students who failed</h1>
	<div id="failedStudents"></div>
	<h1>Thoreau Grade 11</h1>
	<div id="throeauGrade11"></div>
	<h1>Sort by Grade</h1>
	<div id="sortByGrade"></div>
	<h1>School</h1>
	<div id="groupBySchool"></div>
	<h1>Grade</h1>
    <div id="countByGrade"></div>
    <h1>Shuffled Students</h1>
	<div id="shuffledStudents"></div>
	<h1>Students' Grades</h1>
	<div id="grades"></div>
</body>
</html>
